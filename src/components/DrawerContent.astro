---

---

<div class="input-group">
  <input type="text" id="titleInput" placeholder="Enter title"/>
  <input type="text" id="passwordInput" placeholder="Enter username" />
  <button id="addEntryButton" disabled>Add Entry </button>
</div>

<div class="entries-list" id="entriesList"></div>

<script>
import {
	createPasswordEntry,
	getAllPasswordEntries,
	deletePasswordEntry,
	type PasswordEntry,} from "../utils/surrealdb";
import { waitForElement } from "../utils/waitForElement";
import { createSignal, createEffect } from "solid-js";


// signals
const [entries, setEntries] = createSignal<PasswordEntry[]>([])
const [newTitle, setNewTitle] = createSignal('')
const [newPassword, setPassword] = createSignal('');


// initialize entries
(async () => {setEntries(await getAllPasswordEntries() ?? []);})();


// await elements
(async () => {
	const inputGroup = (await waitForElement(".input-group")) as HTMLElement;
	const entriesList = (await waitForElement("#entriesList")) as HTMLElement;

    // render entries based on signal
	createEffect(() => {
		entriesList.innerHTML = "";
		[...(entries() ?? [])].reverse().forEach((entry) => {
			const entryElement = document.createElement("div");
			entryElement.className = "entry-item";
			entryElement.innerHTML = `
            <div>
                <p class="hint">${entry.title}</p>
                <p>${entry.password}</p>
            </div>
            <button class="delete-button" id="${entry.id.id}" >
                <svg width="24" height="24" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21.5 6a1 1 0 0 1-.883.993L20.5 7h-.845l-1.231 12.52A2.75 2.75 0 0 1 15.687 22H8.313a2.75 2.75 0 0 1-2.737-2.48L4.345 7H3.5a1 1 0 0 1 0-2h5a3.5 3.5 0 1 1 7 0h5a1 1 0 0 1 1 1Zm-7.25 3.25a.75.75 0 0 0-.743.648L13.5 10v7l.007.102a.75.75 0 0 0 1.486 0L15 17v-7l-.007-.102a.75.75 0 0 0-.743-.648Zm-4.5 0a.75.75 0 0 0-.743.648L9 10v7l.007.102a.75.75 0 0 0 1.486 0L10.5 17v-7l-.007-.102a.75.75 0 0 0-.743-.648ZM12 3.5A1.5 1.5 0 0 0 10.5 5h3A1.5 1.5 0 0 0 12 3.5Z" fill="#ffffff"/>
                </svg>
            </button>
            `;
			entriesList.appendChild(entryElement);
		});
	});

    // delete entry
	entriesList.addEventListener("click", (e) => {
		const deleteButton = (e!.target as HTMLInputElement).closest(".delete-button");
		if (deleteButton) {
			(async () => {
				await deletePasswordEntry(deleteButton.id);
				setEntries((await getAllPasswordEntries()) ?? []);
			})();
		}
	});

    // add entry
	inputGroup.addEventListener("click", (e) => {
		if ((e!.target as HTMLInputElement).matches("#addEntryButton")) {
			(async () => {
				await createPasswordEntry(newTitle(), newPassword());
				setNewTitle("");
				setPassword("");
				setEntries((await getAllPasswordEntries()) ?? []);
			})();
		}
	});

    // bind input values to signals
	inputGroup.addEventListener("input", (e) => {
        if ((e!.target as HTMLInputElement).matches("#titleInput")){
			setNewTitle((e!.target as HTMLInputElement).value);
		} else if ((e!.target as HTMLInputElement).matches("#passwordInput")) {
			setPassword((e!.target as HTMLInputElement).value);
		}
	});

	// bind signals to input values
	createEffect(() => {
		(document.getElementById("titleInput")! as HTMLInputElement).value = newTitle();
	});

	createEffect(() => {
		(document.getElementById("passwordInput")! as HTMLInputElement).value = newPassword();
	});

	// update add entry button state
	createEffect(() => {
		if (!newTitle() || !newPassword()) {
			(document.getElementById("addEntryButton")! as HTMLButtonElement).disabled = true;
		} else {
			(document.getElementById("addEntryButton")! as HTMLButtonElement).disabled = false;
		}
	});

})();

</script> 


<style is:global>
  .entries-list{
    display: flex;
    flex-direction: column;
  }
  
  .entry-item{
    display: flex;
    place-content: space-between;
    width: min(100%, 65ch);
    background-color: oklch(25% 0 0);
    border-radius: 0;
    padding: var(--default-padding);
    margin: 0 1ch;
  }

  .entries-list > :first-child{
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    margin-top: 1ch;
  }

  .entries-list > :last-child{
    border-bottom-left-radius: 10px;
    border-bottom-right-radius: 10px;
    margin-bottom: 1ch;
  }

  .entries-list > :not(:last-child){
    border-bottom:1px solid black;
  }


</style>
